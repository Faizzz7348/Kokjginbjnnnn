<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
        .success { color: #0f0; }
        .error { color: #f00; }
        pre { background: #000; padding: 10px; border: 1px solid #0f0; }
    </style>
</head>
<body>
    <h1>üß™ API Test Page</h1>
    
    <button onclick="testHealth()">Test Health</button>
    <button onclick="testGetProducts()">Get Products</button>
    <button onclick="testCreateProduct()">Create Product</button>
    <button onclick="testUpdateProduct()">Update Product</button>
    <button onclick="testDeleteProduct()">Delete Product</button>
    
    <div id="output"></div>
    
    <script>
        const API_URL = 'http://localhost:3001/api';
        const output = document.getElementById('output');
        
        function log(message, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'error' : 'success';
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            output.appendChild(div);
        }
        
        async function testHealth() {
            output.innerHTML = '';
            try {
                log('Testing health endpoint...');
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                log(`‚úÖ Health: ${JSON.stringify(data)}`);
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, true);
            }
        }
        
        async function testGetProducts() {
            output.innerHTML = '';
            try {
                log('Getting products...');
                const response = await fetch(`${API_URL}/products`);
                const data = await response.json();
                log(`‚úÖ Got ${data.length} products`);
                output.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, true);
            }
        }
        
        async function testCreateProduct() {
            output.innerHTML = '';
            const newProduct = {
                code: `TEST${Date.now()}`,
                name: 'Test Product',
                description: 'Test description',
                price: 99.99,
                category: 'Test',
                quantity: 10,
                inventoryStatus: 'INSTOCK',
                rating: 5
            };
            
            try {
                log('Creating product...');
                const response = await fetch(`${API_URL}/products`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newProduct)
                });
                const data = await response.json();
                log(`‚úÖ Created product ID: ${data.id}`);
                output.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                window.lastProductId = data.id;
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, true);
            }
        }
        
        async function testUpdateProduct() {
            output.innerHTML = '';
            if (!window.lastProductId) {
                log('‚ùå Run "Create Product" first!', true);
                return;
            }
            
            const update = {
                code: 'UPDATED',
                name: 'Updated Product',
                description: 'Updated',
                price: 199.99,
                category: 'Updated',
                quantity: 20,
                inventoryStatus: 'LOWSTOCK',
                rating: 4
            };
            
            try {
                log(`Updating product ${window.lastProductId}...`);
                const response = await fetch(`${API_URL}/products/${window.lastProductId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(update)
                });
                const data = await response.json();
                log(`‚úÖ Updated product`);
                output.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, true);
            }
        }
        
        async function testDeleteProduct() {
            output.innerHTML = '';
            if (!window.lastProductId) {
                log('‚ùå Run "Create Product" first!', true);
                return;
            }
            
            try {
                log(`Deleting product ${window.lastProductId}...`);
                const response = await fetch(`${API_URL}/products/${window.lastProductId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                log(`‚úÖ Deleted product`);
                output.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                window.lastProductId = null;
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, true);
            }
        }
        
        // Auto test on load
        window.onload = () => {
            testHealth();
        };
    </script>
</body>
</html>
